<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Indianapolis Colts — News</title>

  <!-- PWA / icons (make sure these files exist in /static) -->
  <link rel="icon" href="/indianapolis-colts/static/favicon.ico">
  <link rel="apple-touch-icon" href="/indianapolis-colts/static/apple-touch-icon.png">
  <link rel="manifest" href="/indianapolis-colts/static/manifest.webmanifest">
  <meta name="theme-color" content="#0b3a79">

  <link rel="stylesheet" href="/indianapolis-colts/static/style.css">
</head>
<body>
<header class="hero">
  <div class="hero__brand">
    <img class="hero__logo" src="/indianapolis-colts/static/icon-192.png" alt="Colts logo" width="64" height="64">
    <div>
      <h1>Indianapolis Colts — News</h1>
      <p class="tagline">Live team feed • auto-updates</p>
    </div>
  </div>

  <nav class="quicklinks" aria-label="Quick links">
    <a class="chip" target="_blank" href="https://www.colts.com/schedule/">Schedule</a>
    <a class="chip" target="_blank" href="https://www.colts.com/team/players-roster/">Roster</a>
    <a class="chip" target="_blank" href="https://www.colts.com/team/depth-chart">Depth Chart</a>
    <a class="chip" target="_blank" href="https://www.colts.com/team/injury-report/">Injury Report</a>
    <a class="chip" target="_blank" href="https://shop.colts.com/">Team Shop</a>
    <a class="chip" target="_blank" href="https://www.ticketmaster.com/indianapolis-colts-tickets/artist/805944">Tickets</a>
    <a class="chip" target="_blank" href="https://www.reddit.com/r/Colts/">Reddit</a>

    <a class="chip" target="_blank" href="https://bleacherreport.com/indianapolis-colts">Bleacher Report</a>
    <a class="chip" target="_blank" href="https://www.espn.com/nfl/team/_/name/ind/indianapolis-colts">ESPN Team</a>
    <a class="chip" target="_blank" href="https://sports.yahoo.com/nfl/teams/ind/">Yahoo Team</a>
    <a class="chip" target="_blank" href="https://www.pff.com/nfl/teams/indianapolis-colts">PFF Team Page</a>
    <a class="chip" target="_blank" href="https://www.pro-football-reference.com/teams/clt/">Pro-Football-Reference</a>
    <a class="chip" target="_blank" href="https://www.espn.com/nfl/powerrankings">NFL Power Rankings</a>
    <a class="chip" target="_blank" href="https://www.teamrankings.com/nfl/teams/indianapolis-colts">Stats</a>
    <a class="chip" target="_blank" href="https://www.espn.com/nfl/standings">Standings</a>
  </nav>
</header>

<main class="content">
  <section class="controls">
    <div class="control-row">
      <label class="label" for="sourceSelect">Source:</label>
      <div class="select-wrap">
        <select id="sourceSelect" aria-label="Filter by source"></select>
      </div>

      <div class="updated">
        <span class="label">Updated:</span>
        <time id="updatedAt" aria-live="polite">—</time>
      </div>
    </div>
  </section>

  <section id="feed" class="feed" aria-live="polite" aria-busy="true">
    <!-- cards go here -->
  </section>

  <footer class="footer">
    Powered by GitHub Pages
  </footer>
</main>

<script>
(async function () {
  const FEED_URL = "/indianapolis-colts/items.json"; // must be at the repo root (Pages)
  const feedEl   = document.getElementById('feed');
  const selectEl = document.getElementById('sourceSelect');
  const updatedEl= document.getElementById('updatedAt');

  function fmtDate(d) {
    try {
      const date = (d instanceof Date) ? d : new Date(d);
      // Example: Sep 8, 2025, 4:41 AM
      return date.toLocaleString(undefined, {
        month: 'short', day: 'numeric', year: 'numeric',
        hour: 'numeric', minute: '2-digit',
        hour12: true
      });
    } catch {
      return '—';
    }
  }

  function domainOf(url) {
    try { return new URL(url).hostname.replace(/^www\./,''); }
    catch { return ''; }
  }

  function unique(arr) { return [...new Set(arr)]; }

  function renderCards(items) {
    feedEl.innerHTML = '';
    if (!items.length) {
      feedEl.innerHTML = `<p class="empty">No articles yet — the collector will populate shortly.</p>`;
      feedEl.setAttribute('aria-busy', 'false');
      return;
    }

    for (const it of items) {
      const title = it.title || 'Untitled';
      const href  = it.link  || '#';
      const src   = it.source_name || domainOf(it.link) || 'Unknown';
      const when  = it.published_at || it.date || it.pubDate || '';

      const card = document.createElement('a');
      card.className = 'card';
      card.href = href;
      card.target = "_blank";
      card.rel = "noopener";

      card.innerHTML = `
        <h3 class="card__title">${title}</h3>
        <div class="meta">
          <span class="meta__source">${src}</span>
          <span aria-hidden="true">•</span>
          <time class="meta__date">${fmtDate(when)}</time>
        </div>
      `;
      feedEl.appendChild(card);
    }
    feedEl.setAttribute('aria-busy', 'false');
  }

  function buildSourceList(items) {
    const names = unique(items
      .map(i => i.source_name || domainOf(i.link))
      .filter(Boolean))
      .sort((a,b) => a.localeCompare(b));
    selectEl.innerHTML = '';
    const allOpt = new Option('All sources', '');
    selectEl.appendChild(allOpt);
    for (const n of names) {
      selectEl.appendChild(new Option(n, n));
    }
  }

  try {
    const res = await fetch(FEED_URL, {cache: 'no-store'});
    const json = await res.json();

    // items.json can be { items: [...], sources: {...}, updated_at: "..." }
    const items = Array.isArray(json) ? json :
                  (Array.isArray(json.items) ? json.items : []);
    const updated = json.updated_at || new Date();

    updatedEl.textContent = fmtDate(updated);
    buildSourceList(items);

    // filter behavior
    function applyFilter() {
      const sel = selectEl.value.trim();
      if (!sel) {
        renderCards(items.slice(0, 50)); // cap at 50
      } else {
        const filtered = items.filter(i =>
          (i.source_name && i.source_name === sel) ||
          (!i.source_name && domainOf(i.link) === sel)
        );
        renderCards(filtered.slice(0, 50));
      }
    }
    selectEl.addEventListener('change', applyFilter);
    applyFilter();
  } catch (e) {
    feedEl.innerHTML = `<p class="empty">Couldn’t load feed (items.json). Check that GitHub Actions updated it.</p>`;
    feedEl.setAttribute('aria-busy', 'false');
    console.error(e);
  }
})();
</script>
</body>
</html>