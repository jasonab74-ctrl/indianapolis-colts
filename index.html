<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Indianapolis Colts — News</title>

  <!-- Icons + Manifest (files already present in repo root) -->
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16.png">
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#002C5F">

  <link rel="stylesheet" href="static/style.css">
</head>
<body>
  <header class="site-header">
    <!-- Hardened logo: try several common filenames, else inline SVG fallback -->
    <div class="logo-wrap">
      <img id="logo" alt="Colts logo" decoding="async" width="28" height="28" />
      <svg id="logoFallback" viewBox="0 0 64 64" aria-hidden="true" style="display:none">
        <!-- generic horseshoe (fallback) -->
        <path fill="#002C5F" d="M20 6c-2 8-6 14-6 26a18 18 0 0 0 36 0c0-12-4-18-6-26h-8c2 7 6 13 6 26a10 10 0 0 1-20 0c0-13 4-19 6-26zM18 50a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm28 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
      </svg>
    </div>
    <h1>Indianapolis Colts — News</h1>
  </header>

  <div id="links" class="pill-row"></div>

  <section class="controls">
    <div class="control">
      <label>Source:</label>
      <select id="sourceSelect"></select>
    </div>
    <div class="control right">
      <label>Updated:</label>
      <span id="updated">--</span>
    </div>
  </section>

  <main id="feed"></main>

  <script>
    // --- Hardened logo loader: probes common filenames, falls back to inline SVG
    (function loadLogo() {
      const paths = [
        "static/colts-logo.png",
        "static/colts_logo.png",
        "static/logo-colts.png",
        "static/logo.png"
      ];
      const img = document.getElementById("logo");
      const fb  = document.getElementById("logoFallback");

      function setSrc(p){ img.src = p; img.style.display="block"; fb.style.display="none"; }

      (async () => {
        for (const p of paths) {
          try {
            const r = await fetch(p, { method: "HEAD" });
            if (r.ok) { setSrc(p); return; }
          } catch(e){}
        }
        // fallback if none exist
        img.style.display="none";
        fb.style.display="block";
      })();
    })();

    const feedEl = document.getElementById('feed');
    const updatedEl = document.getElementById('updated');
    const sourceSelect = document.getElementById('sourceSelect');
    const linksEl = document.getElementById('links');

    function renderLinks(links) {
      linksEl.innerHTML = '';
      (links || []).forEach(l => {
        const a = document.createElement('a');
        a.className = 'pill';
        a.href = l.url;
        a.target = '_blank';
        a.rel = 'noopener noreferrer';
        a.textContent = l.label;
        linksEl.appendChild(a);
      });
    }

    function buildSourceDropdown(items) {
      const sources = Array.from(new Set(items.map(i => i.source).filter(Boolean))).sort();
      sourceSelect.innerHTML = '';
      const optAll = document.createElement('option');
      optAll.value = '';
      optAll.textContent = 'All sources';
      sourceSelect.appendChild(optAll);
      sources.forEach(s => {
        const o = document.createElement('option');
        o.value = s;
        o.textContent = s;
        sourceSelect.appendChild(o);
      });
    }

    function renderItems(items) {
      feedEl.innerHTML = '';
      items.forEach(it => {
        const card = document.createElement('article');
        card.className = 'card';
        const a = document.createElement('a');
        a.href = it.link; a.target = '_blank'; a.rel = 'noopener noreferrer';
        a.className = 'title';
        a.textContent = it.title || '(no title)';
        const meta = document.createElement('div');
        meta.className = 'meta';
        const when = (it.published || '').replace('T',' ').replace('+00:00','');
        meta.textContent = `${it.source || it.feed || ''} · ${when}`;
        card.appendChild(a); card.appendChild(meta);
        feedEl.appendChild(card);
      });
    }

    function applyFilter(all) {
      const src = sourceSelect.value;
      const filtered = src ? all.filter(i => i.source === src) : all;
      renderItems(filtered);
    }

    fetch('items.json', {cache: 'no-cache'})
      .then(r => r.json())
      .then(data => {
        updatedEl.textContent = data.updated || '';
        renderLinks(data.links || []);
        buildSourceDropdown(data.items || []);
        renderItems(data.items || []);
        sourceSelect.addEventListener('change', () => applyFilter(data.items || []));
      })
      .catch(() => { updatedEl.textContent = 'load failed'; });
  </script>
</body>
</html>