<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Indianapolis Colts — News</title>
  <meta name="description" content="Live Indianapolis Colts news feed with auto-updates." />
  <meta name="theme-color" content="#003A70" />

  <!-- PWA / icons -->
  <link rel="manifest" href="/static/manifest.webmanifest">
  <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon-16.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/static/icon-192.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/static/apple-touch-icon.png">

  <link rel="preload" href="/static/style.css" as="style" />
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <header class="site-header">
    <div class="brand">
      <img class="logo" src="/static/logo.png" alt="Colts logo">
      <div class="titles">
        <h1>Indianapolis Colts — News</h1>
        <p class="subtitle">Live team feed • auto-updates</p>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- Quick links -->
    <nav class="chips">
      <a class="chip" href="https://www.colts.com/schedule" target="_blank" rel="noopener">Schedule</a>
      <a class="chip" href="https://www.colts.com/team/players-roster" target="_blank" rel="noopener">Roster</a>
      <a class="chip" href="https://www.ourlads.com/nfldepthcharts/depthchart/IND" target="_blank" rel="noopener">Depth Chart</a>
      <a class="chip" href="https://www.colts.com/injuries" target="_blank" rel="noopener">Injury Report</a>
      <a class="chip" href="https://www.ticketmaster.com/indianapolis-colts-tickets/artist/805983" target="_blank" rel="noopener">Tickets</a>
      <a class="chip" href="https://shop.colts.com" target="_blank" rel="noopener">Team Shop</a>
      <a class="chip" href="https://www.reddit.com/r/Colts/" target="_blank" rel="noopener">Reddit</a>
      <a class="chip" href="https://bleacherreport.com/indianapolis-colts" target="_blank" rel="noopener">Bleacher Report</a>
      <a class="chip" href="https://www.espn.com/nfl/team/_/name/ind/indianapolis-colts" target="_blank" rel="noopener">ESPN Team</a>
      <a class="chip" href="https://sports.yahoo.com/nfl/teams/ind" target="_blank" rel="noopener">Yahoo Team</a>
      <a class="chip" href="https://www.pff.com/nfl/teams/indianapolis-colts" target="_blank" rel="noopener">PFF Team Page</a>
      <a class="chip" href="https://www.pro-football-reference.com/teams/clt/" target="_blank" rel="noopener">Pro-Football-Reference</a>
      <a class="chip" href="https://www.espn.com/nfl/powerrankings" target="_blank" rel="noopener">NFL Power Rankings</a>
      <a class="chip" href="https://www.espn.com/nfl/team/stats/_/name/ind" target="_blank" rel="noopener">Stats</a>
      <a class="chip" href="https://www.espn.com/nfl/standings" target="_blank" rel="noopener">Standings</a>
    </nav>

    <!-- Controls -->
    <section class="controls card">
      <div class="control-row">
        <label for="sourceSel">Source:</label>
        <select id="sourceSel" class="pill"></select>
      </div>
      <div class="control-row">
        <span>Updated:</span>
        <time id="updatedAt" aria-live="polite">—</time>
      </div>
    </section>

    <!-- Articles -->
    <section id="feed" class="feed"></section>

    <template id="itemTpl">
      <article class="item card">
        <a class="item-link" target="_blank" rel="noopener">
          <h3 class="title"></h3>
          <div class="meta">
            <span class="source-pill"></span>
            <span class="dot">•</span>
            <time class="pubtime"></time>
          </div>
        </a>
      </article>
    </template>
  </main>

  <footer class="site-footer">
    <small>Powered by GitHub Pages</small>
  </footer>

  <script>
    const sourceSel = document.getElementById('sourceSel');
    const feedEl = document.getElementById('feed');
    const updatedAtEl = document.getElementById('updatedAt');
    const itemTpl = document.getElementById('itemTpl');

    // US-friendly date format (e.g., "Sep 8, 2025, 4:41 AM")
    const fmtDateTime = (iso) => {
      try {
        const d = new Date(iso);
        return d.toLocaleString('en-US', {
          year: 'numeric', month: 'short', day: 'numeric',
          hour: 'numeric', minute: '2-digit'
        });
      } catch { return iso || ''; }
    };

    // Render helpers
    const renderDropdown = (sources=[]) => {
      sourceSel.innerHTML = '';
      const optAll = document.createElement('option');
      optAll.value = '';
      optAll.textContent = 'All sources';
      sourceSel.appendChild(optAll);

      sources.forEach(s => {
        const o = document.createElement('option');
        o.value = s.id || s.name || s.url || '';
        o.textContent = s.name || s.title || new URL(s.url||'#').hostname;
        sourceSel.appendChild(o);
      });
    };

    const renderItems = (items=[], srcMap={}) => {
      feedEl.innerHTML = '';
      const chosen = sourceSel.value;

      items
        .filter(it => !chosen || (it.source === chosen || it.source_id === chosen || it.source_name === chosen))
        .slice(0, 50) // cap to 50 most recent
        .forEach(it => {
          const clone = itemTpl.content.cloneNode(true);
          const a = clone.querySelector('.item-link');
          const h3 = clone.querySelector('.title');
          const pill = clone.querySelector('.source-pill');
          const t = clone.querySelector('.pubtime');

          a.href = it.link || it.url || '#';
          h3.textContent = it.title || '(Untitled)';

          // Robust source name resolution (prevents "undefined")
          const srcName =
            it.source_name ||
            (it.source && srcMap[it.source]) ||
            (it.source_id && srcMap[it.source_id]) ||
            it.source ||
            (() => { try { return new URL(it.link||it.url).hostname.replace(/^www\./,''); } catch { return 'Source'; }})();

          pill.textContent = srcName;
          t.textContent = fmtDateTime(it.published || it.pubDate || it.date || it.updated);
          feedEl.appendChild(clone);
        });

      if (!feedEl.children.length) {
        feedEl.innerHTML = '<p class="muted">No articles yet — the collector will populate shortly.</p>';
      }
    };

    // Load and wire up
    fetch('items.json', { cache: 'no-store' })
      .then(r => r.json())
      .then(data => {
        const items = data.items || [];
        const sources = data.sources || [];

        // build a quick source map for resolving names
        const srcMap = {};
        sources.forEach(s => { srcMap[s.id] = s.name; srcMap[s.name] = s.name; });

        renderDropdown(sources);
        (function setUpdated() {
          const u = data.updated_at || data.updated || '';
          updatedAtEl.textContent = u ? fmtDateTime(u) : '—';
        })();

        // Initial render
        renderItems(items, srcMap);

        // Filter change
        sourceSel.addEventListener('change', () => renderItems(items, srcMap));
      })
      .catch(() => {
        updatedAtEl.textContent = '—';
        feedEl.innerHTML = '<p class="muted">Could not load items.json</p>';
      });
  </script>
</body>
</html>