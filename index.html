<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Indianapolis Colts — News</title>

  <!-- iOS / favicon / PWA icons -->
  <link rel="icon" href="static/favicon.ico">
  <link rel="apple-touch-icon" href="static/apple-touch-icon.png" sizes="180x180">
  <link rel="manifest" href="static/manifest.webmanifest">
  <meta name="theme-color" content="#0A2342">

  <link rel="stylesheet" href="static/style.css" />
</head>
<body>
  <header class="hero">
    <div class="brand">
      <img class="badge" src="static/logo.png" alt="Colts logo" />
      <div>
        <h1>Indianapolis Colts — News</h1>
        <p class="sub">Live team feed • auto-updates</p>
      </div>
    </div>
  </header>

  <main class="wrap">
    <!-- quick links -->
    <section class="chips">
      <a class="chip" href="https://www.colts.com/schedule/" target="_blank" rel="noopener">Schedule</a>
      <a class="chip" href="https://www.colts.com/team/players-roster/" target="_blank" rel="noopener">Roster</a>
      <a class="chip" href="https://www.ourlads.com/nfldepthcharts/depthchart/IND" target="_blank" rel="noopener">Depth Chart</a>
      <a class="chip" href="https://www.foxsports.com/nfl/indianapolis-colts-player-injuries" target="_blank" rel="noopener">Injury Report</a>
      <a class="chip" href="https://shop.colts.com/" target="_blank" rel="noopener">Team Shop</a>
      <a class="chip" href="https://www.ticketmaster.com/indianapolis-colts-tickets/artist/805936" target="_blank" rel="noopener">Tickets</a>
      <a class="chip" href="https://www.reddit.com/r/Colts/" target="_blank" rel="noopener">Reddit</a>
      <a class="chip" href="https://www.espn.com/nfl/team/_/name/ind/indianapolis-colts" target="_blank" rel="noopener">ESPN Team</a>
      <a class="chip" href="https://sports.yahoo.com/nfl/teams/ind/" target="_blank" rel="noopener">Yahoo Team</a>
      <a class="chip" href="https://www.pff.com/nfl/teams/indianapolis-colts" target="_blank" rel="noopener">PFF Team Page</a>
      <a class="chip" href="https://www.pro-football-reference.com/teams/clt/" target="_blank" rel="noopener">Pro-Football-Reference</a>
      <a class="chip" href="https://www.espn.com/nfl/powerrankings" target="_blank" rel="noopener">NFL Power Rankings</a>
      <a class="chip" href="https://www.teamrankings.com/nfl/team/indianapolis-colts" target="_blank" rel="noopener">Stats</a>
      <a class="chip" href="https://www.espn.com/nfl/standings" target="_blank" rel="noopener">Standings</a>
    </section>

    <!-- toolbar -->
    <section class="toolbar">
      <div class="control">
        <label for="sourceSel">Source:</label>
        <select id="sourceSel"></select>
      </div>
      <div class="stamp">
        <span>Updated:</span>
        <time id="updatedAt">—</time>
      </div>
    </section>

    <!-- feed -->
    <section id="feed" class="feed">
      <p id="emptyMsg" class="empty">No articles yet — the collector will populate shortly.</p>
    </section>
  </main>

  <script>
    // ---- helpers -----------------------------------------------------------
    const fmtDate = (iso) => {
      // Show like: Sep 8, 2025, 4:41 AM
      const d = (iso instanceof Date) ? iso : new Date(iso);
      return d.toLocaleString('en-US', {
        month: 'short', day: 'numeric', year: 'numeric',
        hour: 'numeric', minute: '2-digit'
      });
    };

    // ---- state -------------------------------------------------------------
    let allItems = [];
    let allSources = [];

    // ---- renderers ---------------------------------------------------------
    function renderUpdated(ts) {
      const el = document.getElementById('updatedAt');
      el.textContent = ts ? fmtDate(ts) : '—';
    }

    function renderSources() {
      const sel = document.getElementById('sourceSel');
      sel.innerHTML = '';
      const optAll = document.createElement('option');
      optAll.value = '';
      optAll.textContent = 'All sources';
      sel.appendChild(optAll);

      allSources.forEach(name => {
        const opt = document.createElement('option');
        opt.value = name;
        opt.textContent = name;
        sel.appendChild(opt);
      });

      sel.addEventListener('change', () => renderFeed(sel.value));
    }

    function renderFeed(filterSource = '') {
      const list = document.getElementById('feed');
      const empty = document.getElementById('emptyMsg');
      list.innerHTML = '';
      const items = filterSource
        ? allItems.filter(i => i.source_name === filterSource)
        : allItems;

      if (!items.length) {
        empty.style.display = 'block';
        return;
      }
      empty.style.display = 'none';

      items.forEach(i => {
        const card = document.createElement('article');
        card.className = 'card';
        const a = document.createElement('a');
        a.href = i.link;
        a.target = '_blank';
        a.rel = 'noopener';

        const h3 = document.createElement('h3');
        h3.textContent = i.title;
        a.appendChild(h3);

        const meta = document.createElement('p');
        meta.className = 'meta';
        meta.textContent = `${i.source_name} • ${fmtDate(i.published)}`;

        card.appendChild(a);
        card.appendChild(meta);
        list.appendChild(card);
      });
    }

    // ---- boot --------------------------------------------------------------
    async function init() {
      try {
        const r = await fetch('items.json', { cache: 'no-store' });
        const data = await r.json();

        allItems = (data.items || []).slice(0, 50);          // cap to 50
        allSources = data.sources || [];
        renderSources();
        renderUpdated(data.updated_at || Date.now());
        renderFeed('');
      } catch (e) {
        console.error(e);
        renderUpdated(null);
      }
    }
    init();
  </script>
</body>
</html>